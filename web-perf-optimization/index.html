<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Web Performance Optimization Tips</title>

    <meta name="description" content=""/>
    <meta name="author" content="Serban Balamaci" />

    <!--<link href="http://fonts.googleapis.com/css?family=Corben:400,700" rel="stylesheet" type="text/css">-->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/perf.css">

    <link href='http://git-scm.com/favicon.ico' rel='shortcut icon' type='image/x-icon'>

    <!--<link href="http://fonts.googleapis.com/css?famly=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />-->

    <style type="text/css">
        .background {
            position: fixed;
            height: 100%;
            width: 100%;
            background: -moz-radial-gradient(50% 50%, farthest-side, #fff, #efefef);
            background: -webkit-gradient(radial, 50% 50%, 350, 50% 50%, 750, from(#fff), to(#bbb));
            z-index: 0;
        }
        .white {
            height: 100%;
            width: 100%;
            background: #fff;
        }
    </style>
</head>
<body class="impress-not-supported background">
<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>

<div id="impress">
<div id="subject" class="step" data-x="-5000" data-y="-1500" data-scale="10">
    <h1>Web Performance</h1>
    <h2 style="margin-top: 10px;">Optimization Tips</h2>
    <div>
        <a href="https://github.com/balamaci/presentations/tree/master/web-perf-optimization">See Detailed Summary</a>
    </div>
    <img src="http://25.media.tumblr.com/tumblr_mbqrbbE09s1rb5qwwo1_500.gif"/>
</div>


<div id="rules" class="step" data-x="500" data-y="-5000" data-scale="2">
    <h2>Performance golden rules</h2>
    <ul class="topics">
        <li>
            <span class="title">Reduce RTT and data exchanged on the wire</span>
            <span class="desc">-Use Keep-Alive header to reuse connections(default for Http 1.1)</span>
            <span class="desc">-Use a CDN</span>
            <span class="desc">-Minify resources and apply compression</span>
        </li>
        <li>
            <span class="title">Minimize number of requests</span>
            <span class="desc">Browsers are limited to 6 concurrent connections per host name</span>
            <span class="desc">-Merge resources - JS, CSS and Sprites for images</span>
            <span class="desc">-Use Data-URIs</span>
        </li>
        <li>
            <span class="title">Try to make more simultaneous requests</span>
            <span class="desc">-JS and CSS files at the head block rendering</span>
            <span class="desc">Arrange the request flow so that requests do not block and serialize</span>
        </li>
        <li>
            <span class="title">Progressive enhancement</span>
            <span class="desc">Determine a set of "critical" resources that are required for rendering the page in a seeming usable state for the user</span>
            <span class="desc">Improve user experience by downloading in "the background" additional JS, resources for functionality as the user decides what to do next.</span>
        </li>
        <li>
            <span class="title">Cache is king</span>
        </li>
    </ul>
</div>

<div id="tools" class="step" data-x="500" data-y="-6500" data-scale="2">
    <ul class="topics">
        <li><span class="title">YSLow / PageSpeed</span></li>
        <li><span class="title"><a href="">BrowserScope</a></span></li>
        <li><span class="title"><a href="http://www.webpagetest.org/">WebPageTest</a></span></li>
        <li><span class="title"><a href="chrome://net-internals">chrome://net-internals</a></span></li>
        <li><span class="title"><a href="http://yahoo.github.com/boomerang/doc/">boomerang</a></span></li>
    </ul>
</div>


<div id="waterfall" class="step" data-x="3000" data-y="-5000" data-scale="2">
    <a href="">
        <img src="http://www.webpagetest.org/waterfall.php?test=121017_Z8_X2C&run=1&cached=0" alt="" width="800" height="600"/>
    </a>

</div>

<div id="cdn" class="step" data-x="6000" data-y="-5000" data-scale="2">
    <h3>Use a CDN</h3>
    <img src="img/cdn.png" alt="CDN"/>
    <ul class="topics">
        <li>Faster connections and downloads - reduced latency</li>
        <li>Domain sharding - more concurrent connections</li>
        <li>Reduced load on own servers</li>
    </ul>
</div>

<div id="how_cdn_work" class="step" data-x="9000" data-y="-5000" data-scale="2">
        <pre class="code left" style="width:600px;">
<b>$ dig js.web.de</b>
js.web.de.              CNAME   js.web.de.edgekey.net.
js.web.de.edgekey.net   CNAME   e5416.g.akamaiedge.net.
e5416.g.akamaiedge.net. A       2.16.109.234</pre>
    <div class="left">
        <img src="img/dns.png" alt="DNS"/>
    </div>
    <div class="right" style="width: 300px;">
        <h3>How do they work?</h3>
        <ul class="topics-small">
            <li><b>CNAME</b> is an alias</li>
            <li>Use GeoIp to check supplied A record</li>
            <li>Google Public DNS used to make CDNs missperform</li>
        </ul>
    </div>
</div>
<div id="custom_origin" class="step" data-x="12000" data-y="-5000" data-scale="2">
    <div>Common misconception that CDNs only act as a mirroring server</div>
    <div style="font-size: 0.7em;">They can act as a Reverse Proxy - Custom Origin(CloudFront)</div>
    <img src="http://www.nczonline.net/blog/wp-content/uploads/2011/11/cdn2.png" alt="">
</div>

<div id="benefits" class="step" data-x="15000" data-y="-5000" data-scale="2">
    <ul class="topics">
        <li>
            <span class="title">Domain sharding: Split statics to multiple CDNs</span>
            <span class="desc"><b>js.web.de</b>, <b>css.web.de</b>, <b>img.web.de</b> - further => <b>img1.web.de</b></span>
            <span class="desc"> <b>(+)</b> Max concurrent connections for resource retrieval increase</span>
            <span class="desc"> <b>(-)</b> Relative referencing no longer works : `background-image:url('../img/paper.gif');`</span>
            <span class="desc"> <span>Solution:</span> Using placeholders that are replaced at build time: `background-image:url('${img_cdn}/paper.gif');` </span>
            <span class="desc"> <b>(-)</b> Additional DNS lookups to resolve subdomains</span>
        </li>
        <li style="margin-top: 10px;">
            <span class="title">Most famous JS libraries have already known CDN locations to use</span>
            <span class="desc">Using those may mean that the library it's already in cache when a user comes for the first time</span>
            <span class="desc">Checkout http://cdnjs.com/index.html to add</span>
            <span class="desc">DON'T use GitHub references: <i>http://bartaz.github.com/impress.js/js/impress.js</i> They don't set any caching headers.</span>
        </li>
    </ul>

</div>

<div id="merging" class="step" data-x="500" data-y="-3000" data-scale="2">
    <h3>JS and CSS merging and minification</h3>

    <ul class="topics-small">
        <li>Reason behind merging of JS and CSS resources is related to making fewer requests</li>
        <img src="https://developers.google.com/speed/docs/insights/images/externaljs1.png"/>
        <li>
            <span class="title">Older browsers used to serialize downloads of JS resources</span>
            <span class="desc">They wanted to prevent unnecessary downloading of resources - eventual <i>document.write("&lt!--")</i></span>
        </li>
        <li>
            <span class="title">No longer true for more recent browsers(IE8 was first one)</span>
        </li>
    </ul>
    <img src="img/paralel.png"/>
</div>

<div id="minify" class="step" data-x="3000" data-y="-3000" data-scale="2">
    <h3>Minification</h3>
    <ul class="topics-small">
        <li>
            <span class="title">Removes spaces and comments, renames function and variable names</span>
        </li>
        <li>
            <span class="title">You'd expect the same result with gzipping the JS/CSS resource - actually it's a 5-10% more decrease in size</span>
        </li>
        <li>
            <span class="title">Wide selection of tools for minification</span>
            <span class="desc">Uglify.js, Google Closure, YUIMin, Jawr for CSS, etc - check what works for you</span>
        </li>
        <li>
            <span class="title">Use <a href="">wro4j</a></span>
            <span class="desc">Has all the above mentioned options for minifying and merging plus other useful plugins</span>
        </li>
    </ul>
</div>

<div id="wro4j" class="step" data-x="5000" data-y="-3000" data-scale="2" style="padding: 0">
    <h3>wro4j - Web Resource Optimization for Java</h3>

    <div>Brings the concept of "groups of resources"</div>
    <div>Groups can be defined in a <b>wro4j.xml</b> file</div>

        <pre class="code left" style="width:400px;">
&lt;groups xmlns="http://www.isdc.ro/wro"&gt;
  &lt;group name="core"&gt;
    &lt;js&gt;/js/views/app-view.js&lt;/js&gt;
    &lt;js&gt;/js/views/file-browser-view.js&lt;/js&gt;
    &lt;js&gt;/js/models/*.js&lt;/js&gt;
    &lt;js&gt;classpath:com/mysite/resource/js/1.js&lt;/js&gt;
    &lt;css&gt;classpath:com/mysite/resource/css/1.css&lt;/css&gt;
    &lt;group-ref&gt;plugins&lt;/group-ref&gt;
  &lt;/group&gt;

  &lt;group name="plugins"&gt;
    &lt;js&gt;/js/plugins/jquery.modal.js&lt;/js&gt;
    &lt;js&gt;/js/plugins/jquery.progressbar.js&lt;/js&gt;
  &lt;/group&gt;
&lt;/groups&gt;
        </pre>

<pre class="code right" style="width:350px;">
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Wro Test&lt;/title&gt;

    &lt;link rel="stylesheet" type="text/css"
                href="/wro/core.css" /&gt;
    &lt;script type="text/javascript"
                src="/wro/core.js">&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
      //Body
  &lt;/body&gt;
&lt;/html&gt;
</pre>
    <ul class="topics-small">
        <li>
            <span class="title">Run at build time</span>
            <span class="desc">Maven plugin to execute build step</span>
            <span class="desc">Command line <i>java -jar wro4j-runner-1.4.5-jar-with-dependencies.jar</i></span>
        </li>
        <li>
            <span class="title">At runtime</span>
            <span class="desc">Servlet filter to add to <b>web.xml</b> that applies per request the grouping and processors</span>
        </li>
    </ul>
</div>

<div id="wro4j_processors" class="step" data-x="8000" data-y="-3000" data-scale="2" style="padding: 0">
    <ul class="topics-small">
        <li>
            <h3>Pre/Post "Processors"</h3>
            <span class="desc">Set of plugins that alter the file before or after the merging into groups</span>
            <span class="desc">Defined in <b>wro.properties</b> </span>
            <pre class="code-small">
preProcessors=lessCss,cssDataUri,placeholderProcessor
postProcessors=jsMin,cssMinJawr
            </pre>
        </li>

        <li>
            <span class="title"><b>Minifiers</b></span>
            <span class="desc">JSMin, UglifyJs, yuiJs, yuiCss, JawrCss, etc.</span>
        </li>
        <li>
            <span class="title"><b>LESS Processor</b></span>
            <span class="desc">You can also include <b>.less</b> files as group resources and it will trigger <b>less.js</b> to parse those files into <b>.css</b></span>
        </li>
        <li>
            <span class="title"><b>Base64DataUriSupport</b></span>
            <span class="desc">This processor looks for <i>'background-image'</i> and if the referenced image is less than 32KB(IE8 limit for data-uris) transform it do data-uri <div class="red-dot">.</div></span>
        </li>
        <li>
            <span class="title"><b>PlaceholderProcessor</b></span>.
            <span class="desc">Replace ${var_name} with actual values in the resources</span>
        </li>
        <li>
            <span class="title"><b>JSLint</b> and <b>CSSLint</b></span>.
            <span class="desc">Static analysis - "Findbugs" for JS and CSS</span>.
        </li>
    </ul>
</div>

<div id="gzip" class="step" data-x="11000" data-y="-3000" data-scale="2" style="padding: 0">
    <h3>Compressing text on the wire</h3>
    <ul class="topics-small">
        <li>
            Browser and Server negotiate on the compression protocol that will be used to exchange information with each request.
        </li>
        <li>
            <div>Browser negotiate the possible communication by sending a header in the request:</div>
            <div><b>Accept-Encoding: gzip, deflate, sdch</b></div>
            <div>Server responds with the compressed content plus the header</div>
            <div><b>Content-Encoding: gzip</b></div>
        </li>

        <li>Not only text can be compressed, .ico and web fonts, . Good text candidates .xml, .rss, json content type</li>
        <li>Should not set it for resources that are already compressed like .png or .gif, .jpeg</li>
        <li>Best use the <a href="https://github.com/h5bp/html5-boilerplate/blob/master/.htaccess">.htaccess</a> file from the <a href="http://html5boilerplate.com/">HTML5 Boilerplate</a> project as example</li>
    </ul>

</div>

<div id="caching" class="step" data-x="500" data-y="0" data-scale="2">
    <h3>Browser Caching</h3>
    <div>There are several headers that specify how the resources get cached</div>
    <ul class="topics">
        <li>
            <span class="title"><b>Expires Sun, 14 Jan 2014 08:23:12 GMT</b> and <b>Cache-Control: max-age=</b>3600 are <b>"hard"</b> cache directives</span>
                <span class="desc"> - When the browser encounters one of those headers it will cache the resource and for
                    the time specified will consider it fresh and will not try to revalidate and download by issuing other
                    GET request to the server.
                </span>
            <span class="desc"> - It's redundant to set both <b>Expires</b> and <b>Cache-Control</b>, because <b>Cache-Control</b> always takes precedence over the other</span>
        </li>
    </ul>
    <img src="img/cache_hard.png">
</div>
<div id="caching2" class="step" data-x="3500" data-y="0" data-scale="2" style="padding: 0;">
    <ul class="topics">
        <li>
            <span class="title"><b>Last-Modified</b> and <b>ETag</b> are "soft" caching helpers</span>
            <span class="desc">The browser may issue GET requests to the server to check if the resource has been changed on the server.</span>
        </li>
    </ul>
    <ul class="topics">
        <li style="width: 400px;" class="left">
            <span class="title"><b>Last-Modified</b>:Sun, 19 Jun 2011 06:59:22 GMT</span>
            <span class="desc">1. If the resource's valid period had expired browser may issue GET requests with <b>If-Modified-Since</b> header</span>
            <span class="desc">2. Server may just return an empty response content body but with <b>304 Not Modified</b> status</span>

            <img src="http://betterexplained.com/wp-content/uploads/compression/HTTP-caching-last-modified_1.png" alt=""/>
        </li>
        <li style="width: 350px;clear: none;" class="left">
            <span class="title"><b>ETag</b>:"bc10321a2179"</span>
            <span class="desc">Is a programatically generated value to mean an unique identifier for a resource, a fingerprint or version</span>
            <span class="desc">Same logic, only the server has to respond to a check request header <b>If-None-Match</b>if there is a new version of the resource</span>
            <img src="http://betterexplained.com/wp-content/uploads/compression/HTTP_caching_if_none_match.png" alt=""/>
        </li>
        <li>
            <span class="title">Problem with <b>ETag</b></span>
            <span class="desc">The value may be different for the same resources if the request lands on different servers</span>
            <span class="desc">For Apache one can configure <b>FileETag none</b> in the <b>.htaccess</b> file</span>
        </li>
        <li>
            <span class="title">Browser can set both <b>If-Modified-Since</b> and <b>If-None-Match</b> to check validity</span>
        </li>
    </ul>
</div>
<div id="cache_using" class="step" data-x="6500" data-y="0" data-scale="2" style="padding: 0;">

    <ul class="topics">
        <li>
            <span class="title"><b>Apparent conflict</b></span>
            <span class="title">1. We are advised to set <b>Far Future Expiration dates</b> like months for <b>js</b>, <b>css</b></span>
            <span class="title">2. We want the users to see immediately a new version(fix) of a script / css quickly not wait for a week / month </span>
        </li>
        <li>
            <span class="title"><b>Solution</b>: Reference the cacheable resource along with some kind of version token in a file that is not cached (the .html) file</span>
            <ul class="topics-small">
                <li>
                    <span class="title">- <b>Timestamp of files</b></span>
                    <span class="title">&lt;script type="text/javascript" src="/js/site-B0439F858745C84EA46792F9AC42B6CF.js"&gt;&lt;/script&gt;</span>
                </li>
                <li>
                    <span class="title">- <b>Specific file version</b></span>
                    <span class="title">&lt;script type="text/javascript" src="/js/site.js?ver=1.23"&gt;&lt;/script&gt;</span>
                </li>
                <li>
                    <span class="title">- <b>Application version</b></span>
                    <span class="title">&lt;script type="text/javascript" src="/2.14/js/site.js"&gt;&lt;/script&gt;</span>
                </li>
            </ul>
        </li>
    </ul>
    <ul class="topics" style="margin-top:20px;">
        <li><span class="title"><b>Apache config</b></span></li>
        <li>
            <span class="title">To enable browser caching we are enabling in Apache the <b>mod_expires</b> module</span>
            <pre class="code">
<IfModule mod_expires.c>
  ExpiresActive on
  ExpiresByType text/css                  "access plus 1 year"
  ExpiresByType application/javascript    "access plus 1 year"
</IfModule>
            </pre>
        </li>
        <li>This only updates the cache related headers in the browser</li>
        <li></li>
    </ul>
</div>

<div id="block" class="step" data-x="3000" data-y="3000" data-scale="2" style="padding: 0;">
    <ul class="topics">
        <li>
            <span class="title">When browsers encounter a &lt;script&gt; tag they block until they finish downloading and execute the script</span>
            <span class="desc">- The page may seem unresponsive to the user during this time. The rendering process is interrupted</span>
        </li>
        <li>
            <span class="title">Why block and not continue?</span>
            <span class="desc">Browser cannot begin executing bellow scripts(even if they finished downloading before the blocking one) because they might rely on code being available.</span>
            <span class="desc">Think of your libraries that are dependent on JQuery</span>
        </li>
        <li>
            <span class="title">What can Browsers do?</span>
            <span class="desc">- Only look ahead and start downloading and NOT executing following scripts.</span>
            <span class="desc">- Older browsers .</span>
        </li>
</ul>
</div>

<div id="asyncscript" class="step" data-x="3000" data-y="3000" data-scale="2" style="padding: 0;">
    <h3 class="title">What can we do?</h3>

    <ul class="topics">
        <li>
            <span class="title">- Move scripts to page bottom</span>
            <span class="desc">Prevent WSD by moving the blocking script as down as we can => bottom script</span>
        </li>
        <li>
            <span class="title">Make the scripts to not block, make them <b>async</b></span>
            <span class="desc">HTML5 introduced the . See Browserscope for support(IE9 doesn't)</span>
        </li>
        <li>
        </li>
        <li>
            <span class="title">Don't have to wait for <b>async</b></span>
        </li>
    </ul>

</div>

<div id="spdy" class="step" data-x="3000" data-y="6000" data-scale="2" style="padding: 0;">
    <h3>SPDY or HTML2.0</h3>
    <ul class="topics">
        <li><span class="title">Compressed Headers</span>
            <span class="desc">Currently -in HTTP- the headers are sent uncompressed</span>
        </li>
        <li>
            <span class="title">Multiplexing resources on a single connection</span>
            <span class="desc">Single long lasting connection to the server without the need to "warm up" to a high bandwidth</span>
            <span class="desc">We need to do the opposite of domain sharding</span>
        </li>

    </ul>
</div>

<div id="async" class="step" data-x="3000" data-y="6000" data-scale="2" style="padding: 0;">

</div>


</div>

<script src="http://bartaz.github.com/impress.js/js/impress.js"></script>
<script>impress().init();</script>

</body>
</html>